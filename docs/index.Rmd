---
title: "Covid19 data"
output:
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
---

```{r setup, include=FALSE}
library(flexdashboard)
library(covidrecon)
library(tidyverse)
knitr::opts_chunk$set(cache = FALSE)
```

```{r pull-data}
covid <- covid_latest()
```

```{r center-covid-from-100}
selected_countries <- c("China",
                        "Singapore",
                        "Japan",
                        "Iran",
                        "Italy",
                        "Spain",
                        "US",
                        "United_Kingdom",
                        "Australia",
                        "France",
                        "South_Korea")
```

```{r covid-filter}
covid_subset <- covid %>% 
  filter(country_region %in% c(selected_countries, 
                               "United_States_of_America", 
                               "Germany", 
                               "Denmark"))
```


```{r covid-changepoint}
covid_changepoint <- covid_subset %>% 
  add_covid_change_point() %>% 
  filter(date >= change_point_date)
```


Cumulative 
=======================================================================

### Cumulative Incidence

```{r since-100}
covid_since_100 <- covid %>% 
  add_days_since_limit(limit = 100) %>% 
  filter(days_since_limit >= 0)
```

```{r filter}
covid_since_100_selected <- covid_since_100 %>% 
  filter(country_region %in% selected_countries)
```

```{r gg-cumulative-incidence}
gg_covid_cumulative_exceed_limit(covid_since_100_selected, 
                                 limit = 100)
```

Instant Effective Reproduction {.tabset}
=======================================================================

Column  {.tabset}
-----------------------------------------------------------------------

### Selected Countries


```{r covid-instant-repro}
covid_instant_r <- add_instant_reproduction(covid_changepoint)
```


```{r gg-effective-repro-all, cache = FALSE, fig.height = 8, fig.width = 12, cache = FALSE}

gg_effective_repro_all(covid_instant_r)

```

### Per Country

```{r gg-effective-r-facet, fig.height = 8, fig.width = 12}
gg_effective_repro_facet(covid_instant_r) 
```


Case Doubling
=======================================================================

```{r gg-case-doubling}

```


About
=======================================================================

These graphics are licensed with a CC BY-NC-SA License
Users must provide personal and institutional acknowledgement on reuse

Analysis used includes ...

Packages used ...

In turn, we acknowledge RECON, and EuroCDC

Visualisations and analysis made available in the [`covidrecon` package](https://github.com/CBDRH/covidrecon)

